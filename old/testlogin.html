<html>

<head>
    <title>Authentication Example</title>
</head>

<body>
    <form>
        <div>
            <input id="email" type="text" placeholder="Email...">
        </div>
        <div>
            <input id="password" type="password" placeholder="Password...">
        </div>
        <div>
            <button id="sign-in">Sign In/Register</button>
            <button id="sign-out">Sign Out</button>
            <button id="sign-gg">Sign with Google</button>
            <button id="sign-phone">Sign Phone</button>
        </div>
    </form>
    <p id="current-user"></p>

    <!--Include firebase.js  -->
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>


    <!--Configure firebase-->
    <script>
        // Visit https://console.firebase.google.com/project/<your project id>/overview and click on "Add Firebase to your web app"
        var config = {
            apiKey: "AIzaSyBF0TF5PQNteZwHVKiq_IqnQYDXmFE7CiM",
            authDomain: "proplante-7d75e.firebaseapp.com",
            databaseURL: "https://proplante-7d75e.firebaseio.com",
            projectId: "proplante-7d75e",
            storageBucket: "proplante-7d75e.appspot.com",
            messagingSenderId: "561205632101",
            appId: "1:561205632101:web:ba99b04a5568e667b0fa8c",
            measurementId: "G-J760F0W3ZF"
        };
        firebase.initializeApp(config);
        firebase.auth().languageCode = 'it';
    </script>

    <!--Handle auth events-->
    <script>
        firebase.auth().onAuthStateChanged(function (user) {
            window.user = user;
            console.log(user.email);
            var cuserr = document.getElementById("current-user");
            cuserr.innerHTML = user.email;
            // Step 1:
            //  If no user, sign in anonymously with firebase.auth().signInAnonymously()
            //  If there is a user, log out out user details for debugging purposes.
        });
    </script>

    <!--Handle page events-->
    <script>
        document.querySelector('#sign-in').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            var email = document.querySelector('#email').value;
            var password = document.querySelector('#password').value
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .catch(function (err) {
                    // Handle errors
                    console.log(err)
                });
            //   var credential = firebase.auth.EmailAuthProvider.credential(email, password);
            //   var auth = firebase.auth();
            //   var currentUser = auth.currentUser;

            // Step 2
            //  Get a credential with firebase.auth.emailAuthProvider.credential(emailInput.value, passwordInput.value)
            //  If there is no current user, log in with auth.signInWithCredential(credential)
            //  If there is a current user an it's anonymous, atttempt to link the new user with firebase.auth().currentUser.link(credential) 
            //  The user link will fail if the user has already been created, so catch the error and sign in.
        });

        document.querySelector('#sign-out').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            firebase.auth().signOut();
        });
        document.querySelector('#sign-gg').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            var provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('profile');
            provider.addScope('email');
            provider.addScope('https://proplante-7d75e.firebaseio.com');
            firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
        })

        document.querySelector('#sign-phone').addEventListener('click', function (e) {
            // firebase.auth().settings.appVerificationDisabledForTesting = true;

            var phoneNumber = "+664560645";
            var testVerificationCode = "123456";
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sign-phone', {
                'size': 'invisible',
                'callback': function (response) {
                    // reCAPTCHA solved, allow signInWithPhoneNumber.

                }
            });

            recaptchaVerifier.render().then(function (widgetId) {
                window.recaptchaWidgetId = widgetId;
            });


            var recaptchaResponse = grecaptcha.getResponse(window.recaptchaWidgetId);
            console.log(recaptchaResponse);


            // This will render a fake reCAPTCHA as appVerificationDisabledForTesting is true.
            // This will resolve after rendering without app verification.
            var appVerifier = window.recaptchaVerifier;

            // signInWithPhoneNumber will call appVerifier.verify() which will resolve with a fake
            // reCAPTCHA response.
            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then(function (confirmationResult) {
                    // confirmationResult can resolve with the whitelisted testVerificationCode above.
                    return confirmationResult.confirm(testVerificationCode)
                }).catch(function (error) {
                    // Error; SMS not sent
                    // ...
                    console.log(error)
                });

        })
    </script>

</body>

</html>